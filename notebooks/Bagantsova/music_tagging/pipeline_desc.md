# Обзор кода: обработка аудио и классификация музыкальных жанров

## 1. Загрузка данных
Мы используем два источника данных:
1. **Локальные аудиофайлы** — загружаем WAV-файлы из папок, где каждая папка представляет музыкальный жанр.
2. **Готовый датасет** (`luli0034/music-tags-to-spectrogram`) — загружаем уже подготовленные спектрограммы.

## 2. Предварительная обработка аудио
- Аудиофайлы разбиваются на отрезки **по 4 секунды** с перекрытием **в 2 секунды**.
- Из аудио создаются **мел-спектрограммы**, которые затем **сохраняются в сжатом формате `.npz`**.
- Все сохраненные файлы хранятся в кэше (`spectrogram_cache` и `image_cache`), а в дальнейшем модель использует **только пути к файлам**, а не сами данные в оперативной памяти. Это позволяет **значительно экономить RAM**.

## 3. Обработка изображений спектрограмм
- Спектрограммы загружаются, разделяются на небольшие части и сохраняются в `.npz` файлах.
- Используется **параллельная обработка**, чтобы ускорить процесс.

## 4. Архитектура нейросети
Модель **SpectrogramCNN** — это **сверточная нейросеть**, состоящая из:
- **Трех блоков сверточных слоев** с `BatchNorm` и `ReLU`,
- **Макспулинга** для уменьшения размерности,
- **Дропаута** для регуляризации,
- **Глобального усредненного пулинга**,
- **Полносвязного классификатора**.

## 5. Функция ошибки
Мы используем **Asymmetric Focal Loss**, которая помогает лучше работать с несбалансированными классами. Эта функция ошибки:
- Уменьшает вес частых классов (чтобы модель не переучивалась на них),
- Усиливает влияние редких классов.

## 6. Обучение модели
- Обучение идет **с визуализацией** (графики потерь и точности).
- Используется **Adam** с L2-регуляризацией (`weight_decay`).
- Каждые 5 эпох обновляются графики, чтобы отслеживать процесс.

## 7. Оценка модели
- После обучения модель тестируется, и мы получаем **отчет о классификации** (`classification_report`).
- Также вычисляется **точность** (`accuracy_score`).

## 8. Классификация жанров
Мы **вручную выделяем** самые популярные жанры, чтобы уменьшить количество классов и улучшить качество классификации.
